## Process User Input
### Author
Role R4: Thanina AIT FERHAT
 

This is a FastAPI application designed to process user input and classify it as either a casual conversation or a service request. The application interacts with two APIs:

### 1. **R1 API**
A language model API that classifies the user's input and generates responses based on the type of interaction.

### 2. **Broker API**
An API that processes decision-making requests from users, helping to make informed decisions based on their input.

The application saves conversation histories in a PostgreSQL database, which can be queried to retrieve the conversation history for a given session.

## Features

- Classifies user input as either a casual conversation or a decision-making request.
- Calls the **R1 API** for natural language generation.
- Interacts with the **Broker API** for decision-making requests.
- Stores conversation history in a PostgreSQL database.
- Exposes an endpoint to process user input and respond accordingly.

## Requirements

- Python 3.7+
- PostgreSQL
- FastAPI
- SQLAlchemy
- Pydantic
- Requests


## Setup

### 1. Clone the Repository

```bash
git clone https://github.com/your-username/r4-process-user-input.git
cd R4-process-user-input
```
2. Create a Virtual Environment
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```
3. Install Dependencies
```bash
pip install -r requirements.txt
```
4. Set Up the Database
Ensure that you have a PostgreSQL instance running. Create a new database and update the DATABASE_URL in the .env file with the appropriate credentials.


### Example DATABASE_URL in .env file
```bash
DATABASE_URL=postgresql://user:password@localhost:5432/db_name
```
Run the following command to create the necessary tables in the database:

```bash
python role4_service.py
```
5. Running the Application
To start the FastAPI server, run:

```bash
uvicorn app.role4_service:app --reload
```
The application will be available at http://127.0.0.1:8004.

## API Endpoints

To test the `/process_input` endpoint, you can send a POST request with the following JSON body:

```bash
{
    "session_id": "session123",
    "user_message": "Can you help me choose a restaurant?"
}
```
Example curl request:

```bash
curl -X 'POST' \
  'http://127.0.0.1:8004/process_input' \
  -H 'Content-Type: application/json' \
  -d '{
  "session_id": "session123",
  "user_message": "Can you help me choose a restaurant?"
}'
```
The response will be a JSON object with the following structure:

```json
{
    "response": "Sure, I can help you with that!",
    "session_id": "session123"
}
```

The `/classify_input` endpoint is responsible for classifying the user's input as either a service request or a casual conversation. It uses the `classify_input` function to determine the type of input based on the user's message.

This endpoint receives a `UserInput` object containing the user's session ID and message. It then classifies the message and returns a boolean indicating whether the input is a service request (`true`) or a casual conversation (`false`).


To use this endpoint, send a POST request with the following JSON body:
```json
{
  "session_id": "session123",
  "user_message": "Can you help me choose a restaurant?"
}
```
Example cURL request:
```bash
{
curl -X 'POST' \
  'http://127.0.0.1:8000/classify_input' \
  -H 'Content-Type: application/json' \
  -d '{
  "session_id": "session123",
  "user_message": "Can you help me choose a restaurant?"
}
```
Response
The response will be a boolean indicating whether the user's input is a service request (true) or a casual conversation (false).

Example Response:
```json
{
true
}
````
## 1. Classify User Input
The application starts by classifying the user's input using the `classify_input` function. This function determines whether the input corresponds to:

- **A casual conversation**.
- **A service request** (decision-making request).

If the input contains keywords related to decision-making, it will be classified as a service request. Otherwise, it will be considered a casual conversation.

## 2. Casual Conversation
If the input is classified as a casual conversation:

- The application sends the input to the **R1 API**, which generates an appropriate response.
- This interaction is then recorded in the database, including the response generated by the assistant.

## 3. Decision Request
If the input is classified as a service request:

- The application sends the input to the **Broker API** to process the request.
- The response generated by the **Broker API** is then sent to the **R1 API**, which transforms this response into natural language.
- Finally, the response is recorded in the database, including the response generated by the assistant.



