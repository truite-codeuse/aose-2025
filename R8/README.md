## Role 8 - Argumentation Agent

### **Author**
Role R8, **YAYA Latifou**

---

### **📌 Purpose**
This script implements **Role 8** in our multi-role system. It is responsible for integrating various argumentation modules (**R5-R8**) and ensuring seamless interaction with the **Broker Agent (R9)**. Specifically, **Role 8** is in charge of:

1. **Registering itself as a service provider** within the multi-agent system.
2. **Interacting with Role 5 (Scenario Matcher)** to retrieve relevant argumentation scenarios.
3. **Communicating with Role 6 (Problem Solver)** to derive reasoning-based decisions.
4. **Publishing its services to the Broker (R9)** to be discoverable by other agents.

The implementation ensures that user input is correctly processed and routed through the necessary argumentation components before returning a structured response.

---

## **🛠️ Project Overview**

### **🔹 Input**
For optimal functionality, **Role 8** relies on two key inputs:

- **Project Identifier (`project_id`)**:
  - A unique string used to query the **Scenario Matcher (R5)**.
  - Example: `"PRJ15875"`

- **User Message (`message`)**:
  - The natural language input provided by the user.
  - Example: `"What is the best strategy for my project?"`

These inputs are sent as JSON in a **POST request** to the `/process` endpoint.

### **🔹 Processing Pipeline**
1. **Register with the Broker (R9)** to be available as a service provider.
2. **Retrieve matching scenarios** from **R5** based on the user request.
3. **Send the matched scenarios to R6** for reasoning-based decision-making.
4. **Return the final response** to the requesting agent (e.g., the LLM Agent).

### **🔹 Output**
Role 8 generates a structured JSON response containing:
- **`response`**: The final decision or recommendation.
- **`source`**: Indicates that the response was generated by Role 8.

Example Output:
```json
{
    "response": "Based on argumentation analysis, we recommend Strategy X for PRJ15875.",
    "source": "R8"
}
```

---

## **⚙️ Implementation Details**

### **🔹 Registering with the Broker (R9)**
Upon startup, **Role 8** registers itself as an available argumentation service.

```python
def register_with_broker():
    """
    Registers R8 with the Broker Agent (R9).
    """
    payload = {
        "agent_name": "Argumentation_Agent",
        "service": "argumentation",
        "description": "Processes user input and provides argumentation-based solutions."
    }

    try:
        response = requests.post(BROKER_API_URL, json=payload)
        response.raise_for_status()
        print("[INFO] R8 registered successfully with the Broker.")
    except requests.exceptions.RequestException as e:
        print(f"[ERROR] Failed to register R8 with the Broker: {e}")
```

### **🔹 Fetching Argumentation Scenarios from R5**
Role 8 sends a request to **R5** to retrieve relevant argumentation scenarios.

```python
def call_role5(project_id: str, message: str) -> list:
    """
    Requests matching scenarios from R5.
    """
    payload = {"project_id": project_id, "user_input": [message]}
    
    try:
        response = requests.post(ROLE5_API_URL, json=payload)
        response.raise_for_status()
        return response.json()["matched_scenarios"]
    except requests.exceptions.RequestException as e:
        raise HTTPException(status_code=500, detail=f"Error in R5: {e}")
```

### **🔹 Requesting Argumentation-Based Decisions from R6**
Once relevant scenarios are obtained from **R5**, they are sent to **R6** for reasoning.

```python
def call_role6(project_id: str, matched_scenarios: list, user_input: list) -> str:
    """
    Requests a reasoning-based decision from R6.
    """
    payload = {
        "project_id": project_id,
        "user_input": user_input,
        "matched_scenarios": matched_scenarios,
        "info": "Generated by R8"
    }
    
    try:
        response = requests.post("http://localhost:8006/find_solution", json=payload)
        response.raise_for_status()
        return response.json()["text"]
    except requests.exceptions.RequestException as e:
        raise HTTPException(status_code=500, detail=f"Error in R6: {e}")
```

### **🔹 Processing Requests**
This function serves as the main entry point for handling user requests.

```python
@app.post("/process")
def process_argumentation_request(request: ArgumentRequest):
    """
    Handles an argumentation request by:
    1. Fetching relevant scenarios from R5.
    2. Sending those scenarios to R6 for a reasoning-based decision.
    3. Returning the final response.
    """
    matched_scenarios = call_role5(request.project_id, request.message)

    if not matched_scenarios:
        return {"response": "No matching scenarios found.", "source": "R8"}
    
    solution = call_role6(request.project_id, matched_scenarios, [request.message])
    
    return {"response": solution, "source": "R8"}
```

---
🚀 **Developed by YAYA Latifou** | Multi-Agent Argumentation System | 2025

